---
- name: Provision and Configure VM
  hosts: vagrant
  become: yes
  roles:
    - common
    - docker
    - docker_compose



# ---
# - name: Provision and Configure VM
#   hosts: all
#   become: yes
#   tasks:
#     - name: Install dependencies
#       apt:
#         name: "{{ item }}"
#         state: present
#         update_cache: yes
#       loop:
#         - apt-transport-https
#         - ca-certificates
#         - curl
#         - software-properties-common
#         - python3-pip
#         - libffi-dev
#         - libssl-dev

#     - name: Add Docker GPG key
#       apt_key:
#         url: https://download.docker.com/linux/ubuntu/gpg
#         state: present

#     - name: Add Docker repository
#       apt_repository:
#         repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
#         state: present

#     - name: Install Docker
#       apt:
#         name: docker-ce
#         state: present
#         update_cache: yes

#     - name: Ensure Docker service is running
#       systemd:
#         name: docker
#         state: started
#         enabled: yes

#     - name: Install Docker Compose using pip
#       pip:
#         name: docker-compose
#         state: present
#         extra_args: "--ignore-installed"

#     - name: Verify Docker Compose installation
#       command: docker-compose --version

#     - name: Install Docker Compose v2
#       get_url:
#         url: https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64
#         dest: /usr/local/bin/docker-compose
#         mode: '0755'
#       notify:
#         - Restart Docker

#     - name: Use Docker Compose v2 to build and start containers
#       community.docker.docker_compose_v2:
#         project_src: /vagrant
#         state: present
#         build: always
#         remove_orphans: yes

#   handlers:
#     - name: Restart Docker
#       systemd:
#         name: docker
#         state: restarted

